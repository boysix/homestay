<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>


    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap3/js/bootstrap.js"></script>
    <link rel="stylesheet" href="../js/bootstrap3/css/bootstrap.css"/>

    <script src="../js/bootstrap-treeview/bootstrap-treeview.min.js"></script>
    <link rel="stylesheet" href="../js/bootstrap-treeview/bootstrap-treeview.min.css"/>

    <script src="../js/bootStrap-addTabs/bootstrap.addtabs.js"></script>
    <link rel="stylesheet" href="../js/bootStrap-addTabs/bootstrap.addtabs.css"/>

    <script src="../js/bootstrap-table/bootstrap-table.js"></script>
    <script src="../js/bootstrap-table/locale/bootstrap-table-zh-CN.js"></script>
    <link rel="stylesheet" href="../js/bootstrap-table/bootstrap-table.css"/>
    <!-- 引入弹框的js -->
    <script src="../js/bootstrap-bootbox/bootbox.js"></script>

</head>
<body>
<div class="container">
    <div class="row clearfix">
        <div class="col-md-12 column">
            <div class="row clearfix">
                <div class="col-md-12 column">

                    <div class="page-header " style="color: #00bbee">
                        <h3>账户安全</h3>
                    </div>

                    <div class="text-center" >

                    </div>

                </div>
            </div>
            <div class="row clearfix">
                <div class="col-md-6 column"  style="height: 100px;" >

                    <label  class="col-sm-12 control-label">登录密码</label>
                    <div class="col-sm-12">

                        <div class="col-sm-1"></div>
                        <div class="col-sm-11">
                                 安全性高的密码可以使账号更安全。建议你定期更换密码。
                        </div>
                    </div>

                    <div class="col-sm-12" style="margin-top: 10px">

                        <button id="modal-3" href="#modal-container-3" role="button" class="btn btn-primary" data-toggle="modal">修改密码</button>

                        <div class="modal fade" id="modal-container-3" role="dialog" aria-labelledby="myModalLabel3" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                        <h4 class="modal-title" id="myModalLabel3">
                                            填写密码信息
                                        </h4>
                                    </div>

                                    <div class="modal-body">
                                        <form class="form-horizontal" role="form">

                                            <div class="form-group">
                                                <label class="col-md-3">原密码：</label>
                                                <div class="col-md-6">

                                                    <input type="text" class="form-control" id="pwd1" />

                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-md-3">新密码：</label>
                                                <div class="col-md-6">

                                                    <input type="text" class="form-control" id="pwd2" onblur="Mm()" />
                                                    <span id="spanmm"></span>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-md-3">确认新密码：</label>
                                                <div class="col-md-6">

                                                    <input type="text" class="form-control" id="pwd3" onblur="Qrmm()" />
                                                    <span id="spanqrmm"></span>
                                                </div>
                                            </div>

                                            <div class="form-group">

                                                <div class="col-md-6">
                                                    <img src="#" style="height: 100px; width: 150px " id="img" onclick="getCode2(this.src)">
                                                </div>

                                                <div class="col-md-6">
                                                    <a href="javascript:getCode()">看不清楚？换一张</a><br>
                                                </div>

                                            </div>

                                            <div class="form-group">
                                                <label class="col-md-3">验证码：</label>
                                                <div class="col-md-6">

                                                    <input type="text" class="form-control" id="checkcode" onblur="Qrmm()" />
                                                </div>
                                            </div>


                                        </form>

                                    </div>
                                    <div class="modal-footer">

                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>

                                        <button type="button" class="btn btn-primary" onclick="updatepwd()">保存</button>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>

                </div>
                <div class="col-md-6 column"  style="height: 100px;" >

                    <label  class="col-sm-12 control-label">登录手机</label>

                    <div class="col-sm-12">

                        <div class="col-sm-1"></div>
                        <div class="col-sm-11">
                            该手机号用于接受登录验证码,登录您的帐号。
                        </div>
                    </div>

                    <div class="col-sm-12" style="margin-top: 10px">

                        <button id="modal-2" href="#modal-container-12" role="button" class="btn btn-primary" data-toggle="modal">重新绑定</button>

                        <div class="modal fade" id="modal-container-12" role="dialog" aria-labelledby="myModalLabel2" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                        <h4 class="modal-title" id="myModalLabel2">
                                            填写手机号信息
                                        </h4>
                                    </div>

                                    <div class="modal-body">
                                        <form class="form-horizontal" role="form">

                                            <div class="form-group">

                                                <label for="firstname" class="col-sm-3 control-label">登录手机</label>

                                                <div class="col-sm-8">
                                                    <input type="text" class="form-control" name = "entername" id="firstname" placeholder="请输入登录手机">
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label for="lastnames" class="col-sm-3 control-label">验证码</label>
                                                <div class="col-sm-5">
                                                    <input type="text"  name="imgcode" class="form-control" id="lastnames" placeholder="请输验证码">
                                                </div>
                                                <div class="col-sm-4">
                                                    <a href="javascript:code()">获取验证码</a>
                                                </div>
                                            </div>

                                        </form>

                                    </div>
                                    <div class="modal-footer">

                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>

                                        <button type="button" class="btn btn-primary" onclick="updatephone()">保存</button>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>

                </div>
            </div>

            <div class="row clearfix" style="margin-top: 30px">
                <div class="col-md-6 column" style="height: 100px;">

                    <label  class="col-sm-12 control-label">邮箱绑定</label>
                    <div class="col-sm-12">

                        <div class="col-sm-1"></div>
                        <div class="col-sm-11">
                           验证后可接受系统推送的消息。
                        </div>
                    </div>

                    <div class="col-sm-12" style="margin-top: 10px">

                        <button id="modal-11420" href="#modal-container-11420" role="button" class="btn btn-primary" data-toggle="modal">设置邮箱</button>

                        <div class="modal fade" id="modal-container-11420" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                        <h4 class="modal-title" id="myModalLabel">
                                            填写邮箱信息
                                        </h4>
                                    </div>

                                    <div class="modal-body">
                                        <form class="form-horizontal" role="form">

                                            <div class="form-group">
                                                <label class="col-md-3">新邮箱地址：</label>
                                                <div class="col-md-6">

                                                    <input type="email" class="form-control" id="Email1" />

                                                </div>
                                            </div>

                                        </form>

                                    </div>
                                    <div class="modal-footer">

                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>

                                        <button type="button" class="btn btn-primary" onclick="addemail()">保存</button>
                                    </div>
                                </div>

                            </div>

                        </div>

                    </div>




<!--                    <label  class="col-sm-2 control-label">邮箱绑定</label>-->
<!--                    <div class="col-sm-8">-->


<!--                    </div>-->
<!--                    <div class="col-sm-2">-->
<!--                        <button type="button" class="btn btn-primary" onclick="addemail()">绑定邮箱</button>-->

<!--                    </div>-->

                </div>

                <div class="col-md-6 column" style="height: 100px;">

                    <label  class="col-sm-12 control-label">消息订阅</label>
                    <div class="col-sm-12">

                        <div class="col-sm-1"></div>
                        <div class="col-sm-11">
                            接受手机信息、站内通知、邮件等。
                        </div>
                    </div>

                    <div class="col-sm-12" style="margin-top: 10px">

                        <button id="modal-114201" href="#modal-container-1" onclick="queryding()" role="button" class="btn btn-primary" data-toggle="modal">开启提醒</button>

                        <div class="modal fade" id="modal-container-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                        <h4 class="modal-title" id="myModalLabel1">
                                            填写提醒信息
                                        </h4>
                                    </div>

                                    <div class="modal-body">
                                        <form class="form-horizontal" role="form">

                                            <div class="form-group">

                                                <label class="col-md-6">当前状态：</label>
                                                <label class="col-md-6">是否接受邮件消息：</label>
                                                <div class="col-md-6">
                                                    <!--状态-->
                                                    <div id="info_emailstatus"></div>
                                                </div>
                                                <div class="col-md-6">
                                                    <!--按钮-->
                                                    <div id="info_emailstatusShow"></div>
                                                </div>
                                                </div>

                                        </form>

                                    </div>
                                    <div class="modal-footer">

                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>


                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>
<script type="text/javascript">

    /*刷新验证码*/
    getCode = function(){

        $("#img").prop("src","../zqx/codes?sss="+Math.random());

    }

    getCode2 = function(src){

        $("#img").prop("src",src+"?sss="+new Date().getTime());

    }

    /*修改邮箱状态*/
    function openremind(a) {

        //$('#modal-container-1').modal('hide');

        //alert("设置成功");
        var status = '';
        if (a==2){
            status= "退订";
        }else {
            status= "订阅";
        }

        /*alert("设置成功"+status);
        return;*/
        $.ajax({
            url: "../zqx/updateEmailStatus",
            type: "post",
            data:{userID:$("#userid").val(),status:status},
            datatype:"json",
            success: function (data) {

                alert(data);

            },
            error: function () {
                alert("ajax访问失败了,查看控制台");
            }
        });

    }

    /*查询邮箱状态*/
    function queryding() {

        $.ajax({
            url: "../zqx/queryEmailStatus",
            type: "post",
            data:{userID:$("#userid").val()},
            datatype:"json",
            success: function (data) {

                //alert(data);

                $("#info_emailstatus").html(data);

                var eStatus = '';
                if (data=="订阅"){

                    eStatus = ' <button type="button" class="btn btn-primary" onclick="openremind(2)">退订</button>';
                    $("#info_emailstatusShow").html(eStatus);
                }else if (data == "退订"){
                    eStatus = ' <button type="button" class="btn btn-primary" onclick="openremind(1)">订阅</button>';
                    $("#info_emailstatusShow").html(eStatus);
                }


            },
            error: function () {
                alert("ajax访问失败了,查看控制台");
            }
        });


    }

    //绑定邮箱
    function addemail() {
        var textval = $("#Email1").val();
        if (textval==''){
            alert('请输入邮箱');
            return;
        }

        var reg = /^\w{5,}@\w{2,3}\.\w{3}$/
        // if(reg.test(textval)){
        if(true){
            $.ajax({
                url:"../zqx/sendmail",
                type:"post",
                data:{email:textval,id:$("#userid").val()},
                success:function (data) {
                    alert(data);
                }
            })
        }else{
            alert('输入邮箱不正确');
            return;
        }
    }

    //密码
    function Mm(){
        var zh = document.getElementById('pwd2').value
        var regular =/^\w{6,}$/
        if (regular.test(zh)) {
            document.getElementById('spanmm').innerHTML='对'
            return true;
        } else{
            document.getElementById('spanmm').innerHTML="<font color='red'>至少6位</font>"
            return false;
        }
    }

    //确认密码
    function Qrmm(){

        var mm = document.getElementById('pwd2').value
        var qrmm = document.getElementById('pwd3').value
        if (mm==qrmm&&mm!='') {
            document.getElementById('spanqrmm').innerHTML='对'
            return true;
        } else{
            document.getElementById('spanqrmm').innerHTML="<font color='red'>与密码保持一致</font>"
            return false;
        }
    }


    function updatepwd() {
        var ypwd = document.getElementById('pwd1').value;
        var newpwd = document.getElementById('pwd2').value;
        $.ajax({
            url:"../zqx/updateUserpwd",
            type:"post",
            data:{ypwd:ypwd,newpwd:newpwd},
            success:function (data) {
                alert(data);
            }
        })



    }



</script>
</body>
<script type="text/javascript">


     function code() {
        var mobile = $("#firstname").val();

         var regular =/^\d{11}$/;
         if (regular.test(mobile)) {

             $.ajax({
                 url: "../zqx/getCode",
                 type: "post",
                 data: {"mobile":mobile},
                 success: function (data) {
                     alert(data);

                 }
             })
         }else {
             alert("请输入手机号");
         }
    }
</script>
</html>